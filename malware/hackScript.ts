import { NS } from "@ns";

export async function main(ns: NS) {
    const target = String(ns.args[0]);
    // eslint-disable-next-line no-constant-condition
    while (true) {
        if (checkSecurityLevel(ns, target)) {
            await breakSecurity(ns, target)
        } else if (checkMoneyLevel(ns, target)) {
            await growMoney(ns, target)
        } else {
            await ns.hack(target)
        }
    }
}

// TODO: Randomize the threshold levels so not every script is executing the same thing
function checkSecurityLevel(ns: NS, target: string) {
    const serverSecurityLevel = ns.getServerSecurityLevel(target)
    const securityThreshold = ns.getServerMinSecurityLevel(target) + 5
    return serverSecurityLevel > securityThreshold
}

async function breakSecurity(ns: NS, target: string) {
    await ns.weaken(target)
}

function checkMoneyLevel(ns: NS, target: string) {
    const serverMoneyLevel = ns.getServerMoneyAvailable(target)
    const moneyThreshold = ns.getServerMaxMoney(target) * 0.75
    return serverMoneyLevel < moneyThreshold
}

async function growMoney(ns: NS, target: string) {
    await ns.grow(target)
}